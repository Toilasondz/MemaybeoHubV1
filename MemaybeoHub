--== SCRIPT KAVO UI TỐI ƯU: ĐÃ FIX LỖI TOGGLE NÚT NGUỒN ==--

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local CoreGui = game:GetService("CoreGui")

-- Load the Kavo UI library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("Fixed UI", "Ocean") 

-- Biến toàn cục để lưu trữ Frame Kavo chính
local KavoMainFrame = nil
local KavoMainGui = nil -- Thêm biến này để lưu ScreenGui gốc

-- ----------------------------------------------------
-- A. LOGIC VÔ HIỆU HÓA DI CHUYỂN & TÌM FRAME KAVO
-- ----------------------------------------------------

local function findKavoGui()
    for _, gui in pairs(PlayerGui:GetChildren()) do
        if string.find(gui.Name, "Kavo_") and gui:IsA("ScreenGui") then
            return gui
        end
    end
    -- Thử CoreGui
    for _, gui in pairs(CoreGui:GetChildren()) do
        if string.find(gui.Name, "Kavo_") and gui:IsA("ScreenGui") then
            return gui
        end
    end
    return nil
end

local function disableKavoDrag(kavoGui)
    -- Hàm tìm kiếm Frame chính của Kavo (thường là Frame có Active=true)
    local function findMainFrame(parent)
        for _, child in pairs(parent:GetChildren()) do
            if child:IsA("Frame") and (child.Name == "Main" or child.Name == "DragFrame" or child.Active) then
                -- Vô hiệu hóa tính năng di chuyển
                child.Active = false 
                child.Selectable = false
                return child
            end
        end
        return nil
    end

    KavoMainFrame = findMainFrame(kavoGui)
    KavoMainGui = kavoGui -- Lưu ScreenGui gốc

    if KavoMainFrame then
        print("Kavo UI drag disabled and frame located.")
        -- Ẩn ban đầu
        KavoMainFrame.Visible = false
    else
        print("Warning: Could not find Kavo Main Frame.")
    end
end

-- Chờ Kavo UI khởi tạo xong và xử lý
task.spawn(function()
    local kavoGui
    -- Lặp lại việc tìm kiếm cho đến khi Kavo Gui xuất hiện (an toàn hơn)
    repeat
        kavoGui = findKavoGui()
        task.wait(0.1)
    until kavoGui ~= nil

    disableKavoDrag(kavoGui)
end)


-- Cấu trúc UI Kavo (Không chức năng)
local MainTab = Window:NewTab("Main")
local MainSection = MainTab:NewSection("Status")
MainSection:NewLabel("Giao diện UI đã khởi tạo thành công.")
MainSection:NewLabel("---")
MainSection:NewLabel("Chức năng di chuyển đã được cố gắng vô hiệu hóa.")


-- ----------------------------------------------------
-- B. NÚT MỞ/ĐÓNG HÌNH VUÔNG BO GÓC (TÙY CHỈNH)
-- ----------------------------------------------------

local ToggleButton = Instance.new("ScreenGui")
ToggleButton.Name = "CustomToggleButton"
ToggleButton.Parent = PlayerGui
ToggleButton.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local ButtonFrame = Instance.new("Frame")
ButtonFrame.Name = "ToggleFrame"
ButtonFrame.Parent = ToggleButton
ButtonFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45) 
ButtonFrame.BorderColor3 = Color3.fromRGB(0, 0, 0)
ButtonFrame.BorderSizePixel = 0
ButtonFrame.Size = UDim2.new(0, 50, 0, 50) 
ButtonFrame.Position = UDim2.new(0.01, 0, 0.3, 0)
ButtonFrame.Active = true 
ButtonFrame.Selectable = true

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 6)
Corner.Parent = ButtonFrame

local ButtonLabel = Instance.new("TextLabel")
ButtonLabel.Name = "IconLabel"
ButtonLabel.Parent = ButtonFrame
ButtonLabel.BackgroundTransparency = 1
ButtonLabel.Size = UDim2.new(1, 0, 1, 0)
ButtonLabel.Text = "UI" 
ButtonLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
ButtonLabel.Font = Enum.Font.Code
ButtonLabel.TextSize = 18

-- Logic Kéo/Di chuyển Nút Toggle
local dragging = false
local dragStart, startPos
local function startDrag(input)
    if not dragging and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
        dragging = true
        dragStart = input.Position
        startPos = ButtonFrame.Position
    end
end
local function doDrag(input)
    if dragging then
        local delta = input.Position - dragStart
        ButtonFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end
local function stopDrag()
    dragging = false
end
ButtonFrame.InputBegan:Connect(startDrag)
UserInputService.InputChanged:Connect(doDrag)
UserInputService.InputEnded:Connect(stopDrag)

-- Logic Click Nút để Mở/Đóng Kavo UI
ButtonFrame.MouseButton1Click:Connect(function()
    -- Nếu chưa tìm thấy frame, cố gắng tìm lại ngay lúc click
    if not KavoMainFrame then
        local kavoGui = findKavoGui()
        if kavoGui then
            disableKavoDrag(kavoGui)
        end
    end
    
    if KavoMainFrame then
        -- Toggle Visible
        KavoMainFrame.Visible = not KavoMainFrame.Visible
        
        -- Đổi màu nút Toggle để báo hiệu trạng thái
        ButtonLabel.TextColor3 = KavoMainFrame.Visible and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 255, 255)
    else
        game.StarterGui:SetCore("SendNotification", { Title = "Lỗi UI"; Text = "Không tìm thấy Frame chính của Kavo. Đang thử lại..."; Duration = 3; })
    end
end)
